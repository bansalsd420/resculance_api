<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Resculance India - Ambulance Operations Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              900: '#0c4a6e'
            },
            medical: {
              red: '#ef4444',
              orange: '#f97316',
              green: '#22c55e',
              blue: '#3b82f6'
            }
          },
          fontFamily: {
            'sans': ['Inter', 'system-ui', 'sans-serif']
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Leaflet CSS (for Google-like slippy map without API key) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous" />
  <style>
    body { box-sizing: border-box; font-family: 'Inter', system-ui, sans-serif; }
    .pulse-dot { animation: pulse-dot 2s infinite; }
    @keyframes pulse-dot { 0%, 100% { opacity: 1; transform: scale(1);} 50% { opacity: .7; transform: scale(1.1);} }
    .vitals-wave { background: linear-gradient(90deg, #22c55e 0%, #16a34a 50%, #22c55e 100%); background-size: 200% 100%; animation: wave 1.5s linear infinite; }
    @keyframes wave { 0% { background-position: 200% 0;} 100% { background-position: -200% 0;} }
    .card { background: white; border-radius: 8px; border: 1px solid #f1f5f9; box-shadow: 0 1px 3px 0 rgba(0,0,0,.1), 0 1px 2px 0 rgba(0,0,0,.06); transition: all .2s ease; }
    .card:hover { box-shadow: 0 4px 6px -1px rgba(0,0,0,.1), 0 2px 4px -1px rgba(0,0,0,.06); }
    .dark .card { background: #1e293b; border-color: #334155; }
    .status-badge { position: absolute; top: 12px; right: 12px; z-index: 10; }
    .tab-active { background: #0ea5e9; color: white; }
    .tab-inactive { background: transparent; color: #64748b; }
    .tab-inactive:hover { background: #f1f5f9; color: #334155; }
    .dark .tab-inactive { color: #94a3b8; }
    .dark .tab-inactive:hover { background: #334155; color: #e2e8f0; }
    .dropdown { position: relative; }
    .dropdown-content { display: none; position: absolute; background: white; min-width: 200px; box-shadow: 0 10px 15px -3px rgba(0,0,0,.1); border-radius: 8px; border: 1px solid #e2e8f0; z-index: 1000; top: 100%; right: 0; margin-top: 4px; }
    .dropdown.active .dropdown-content { display: block; }
    .dark .dropdown-content { background: #1e293b; border-color: #334155; }
    .metric-card { background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border: 1px solid #e2e8f0; }
    .dark .metric-card { background: linear-gradient(135deg, #1e293b 0%, #334155 100%); border-color: #475569; }
    /* Map container ensures proper height */
    #map { height: 520px; width: 100%; }
    .emoji-icon { line-height: 1; }
  </style>
</head>
<body class="h-full bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
  <div class="h-full flex flex-col bg-slate-50 dark:bg-slate-900">
    <!-- Top Header -->
    <header class="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6 py-4">
      <div class="flex items-center justify-between">
        <!-- Logo & Route -->
        <div class="flex items-center space-x-6">
          <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-primary-500 rounded-lg flex items-center justify-center">
              <span class="text-white font-bold text-sm">R</span>
            </div>
            <div>
              <div class="font-semibold text-slate-900 dark:text-white text-sm">Resculance India</div>
              <div class="text-xs text-slate-500 dark:text-slate-400">Emergency Operations</div>
            </div>
          </div>
          <div class="h-6 w-px bg-slate-300 dark:bg-slate-600"></div>
          <div class="flex items-center space-x-3">
            <div id="fromName" class="text-sm font-medium text-slate-900 dark:text-white">AIIMS Delhi</div>
            <svg class="w-4 h-4 text-primary-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
            </svg>
            <div id="toName" class="text-sm font-medium text-slate-900 dark:text-white">Apollo Hospital</div>
            <span class="px-2 py-1 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300 rounded-md text-xs font-medium">En Route</span>
          </div>
        </div>
        <!-- Status & Controls -->
        <div class="flex items-center space-x-4">
          <div class="text-right">
            <div class="text-xs text-slate-500 dark:text-slate-400">Case ID: RC-2024-001</div>
            <div id="etaHeader" class="text-sm font-medium text-slate-900 dark:text-white">ETA: ‚Äî</div>
          </div>
          <!-- Team Status Dropdown -->
          <div class="dropdown">
            <button class="flex items-center space-x-2 px-3 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" onclick="toggleDropdown('teamDropdown')">
              <div class="w-2 h-2 bg-emerald-500 rounded-full pulse-dot"></div>
              <span class="text-sm font-medium text-slate-700 dark:text-slate-300">4 Online</span>
              <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </button>
            <div class="dropdown-content" id="teamDropdown">
              <div class="p-3">
                <div class="text-xs font-semibold text-slate-500 dark:text-slate-400 uppercase tracking-wide mb-2">Team Status</div>
                <div class="space-y-2">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                      <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
                      <span class="text-sm text-slate-700 dark:text-slate-300">Dr. Sharma</span>
                    </div>
                    <span class="text-xs text-slate-500">Paramedic</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                      <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
                      <span class="text-sm text-slate-700 dark:text-slate-300">Nurse Patel</span>
                    </div>
                    <span class="text-xs text-slate-500">Nurse</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                      <div class="w-2 h-2 bg-amber-500 rounded-full"></div>
                      <span class="text-sm text-slate-700 dark:text-slate-300">Driver Kumar</span>
                    </div>
                    <span class="text-xs text-slate-500">Away</span>
                  </div>
                  <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                      <div class="w-2 h-2 bg-emerald-500 rounded-full"></div>
                      <span class="text-sm text-slate-700 dark:text-slate-300">Control Center</span>
                    </div>
                    <span class="text-xs text-slate-500">Online</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Settings Dropdown -->
          <div class="dropdown">
            <button class="p-2 bg-slate-100 dark:bg-slate-700 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" onclick="toggleDropdown('settingsDropdown')">
              <svg class="w-5 h-5 text-slate-600 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
            </button>
            <div class="dropdown-content" id="settingsDropdown">
              <div class="p-2">
                <button class="w-full text-left px-3 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-md" onclick="toggleTheme()">
                  <span class="dark:hidden">üåô Dark Mode</span>
                  <span class="hidden dark:inline">‚òÄÔ∏è Light Mode</span>
                </button>
                <button class="w-full text-left px-3 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-md">‚öôÔ∏è Preferences</button>
                <button class="w-full text-left px-3 py-2 text-sm text-slate-700 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-md">üìä Analytics</button>
                <hr class="my-2 border-slate-200 dark:border-slate-600">
                <button class="w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md">üö™ Sign Out</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <div class="flex-1 flex overflow-hidden">
      <!-- Sidebar -->
      <aside class="w-80 bg-white dark:bg-slate-800 border-r border-slate-200 dark:border-slate-700 flex flex-col">
        <!-- Sidebar Tabs -->
        <div class="flex border-b border-slate-200 dark:border-slate-700">
          <button class="flex-1 px-4 py-3 text-sm font-medium tab-active" onclick="switchSidebarTab('vitals', this)">Vitals</button>
          <button class="flex-1 px-4 py-3 text-sm font-medium tab-inactive" onclick="switchSidebarTab('devices', this)">Devices</button>
          <button class="flex-1 px-4 py-3 text-sm font-medium tab-inactive" onclick="switchSidebarTab('timeline', this)">Timeline</button>
        </div>

        <!-- Vitals Tab Content -->
        <div id="vitals-tab" class="flex-1 p-4 overflow-y-auto">
          <div class="space-y-4">
            <!-- Quick Metrics -->
            <div class="grid grid-cols-2 gap-3">
              <div class="metric-card p-3 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-xs font-medium text-slate-600 dark:text-slate-400">Heart Rate</span>
                  <div class="w-2 h-2 bg-emerald-500 rounded-full pulse-dot"></div>
                </div>
                <div class="text-2xl font-bold text-slate-900 dark:text-white">78</div>
                <div class="text-xs text-slate-500">BPM</div>
              </div>
              <div class="metric-card p-3 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-xs font-medium text-slate-600 dark:text-slate-400">SpO2</span>
                  <div class="w-2 h-2 bg-emerald-500 rounded-full pulse-dot"></div>
                </div>
                <div class="text-2xl font-bold text-slate-900 dark:text-white">98%</div>
                <div class="text-xs text-slate-500">Normal</div>
              </div>
              <div class="metric-card p-3 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-xs font-medium text-slate-600 dark:text-slate-400">BP</span>
                  <div class="w-2 h-2 bg-emerald-500 rounded-full pulse-dot"></div>
                </div>
                <div class="text-lg font-bold text-slate-900 dark:text-white">120/80</div>
                <div class="text-xs text-slate-500">mmHg</div>
              </div>
              <div class="metric-card p-3 rounded-lg">
                <div class="flex items-center justify-between mb-2">
                  <span class="text-xs font-medium text-slate-600 dark:text-slate-400">Temp</span>
                  <div class="w-2 h-2 bg-emerald-500 rounded-full pulse-dot"></div>
                </div>
                <div class="text-lg font-bold text-slate-900 dark:text-white">98.6¬∞F</div>
                <div class="text-xs text-slate-500">Normal</div>
              </div>
            </div>

            <!-- ECG Waveform -->
            <div class="card p-4">
              <div class="flex items-center justify-between mb-3">
                <h4 class="text-sm font-semibold text-slate-900 dark:text-white">ECG Monitor</h4>
                <div class="status-badge">
                  <span class="px-2 py-1 bg-emerald-500 text-white text-xs rounded-md">Live</span>
                </div>
              </div>
              <div class="h-24 bg-slate-900 rounded-lg relative overflow-hidden">
                <svg class="w-full h-full" viewBox="0 0 400 100">
                  <path d="M0 50 L50 50 L55 20 L60 80 L65 50 L400 50" stroke="#22c55e" stroke-width="2" fill="none" class="vitals-wave"/>
                </svg>
              </div>
            </div>

            <!-- Alarms -->
            <div class="card p-4">
              <h4 class="text-sm font-semibold text-slate-900 dark:text-white mb-3">Active Alarms</h4>
              <div class="space-y-2">
                <div class="flex items-center space-x-3 p-2 bg-amber-50 dark:bg-amber-900/20 rounded-lg">
                  <div class="w-2 h-2 bg-amber-500 rounded-full pulse-dot"></div>
                  <div class="flex-1">
                    <div class="text-sm font-medium text-amber-800 dark:text-amber-200">Low Battery</div>
                    <div class="text-xs text-amber-600 dark:text-amber-400">Pulse Oximeter - 15%</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Devices Tab Content -->
        <div id="devices-tab" class="flex-1 p-4 overflow-y-auto hidden">
          <div class="space-y-4">
            <!-- Digital Stethoscope -->
            <div class="card p-4">
              <div class="flex items-center justify-between mb-3">
                <h4 class="text-sm font-semibold text-slate-900 dark:text-white">Digital Stethoscope</h4>
                <div class="w-2 h-2 bg-emerald-500 rounded-full pulse-dot"></div>
              </div>
              <div class="h-16 bg-slate-100 dark:bg-slate-700 rounded-lg mb-3 relative overflow-hidden">
                <svg class="w-full h-full" viewBox="0 0 200 50">
                  <path d="M0 25 Q50 10 100 25 T200 25" stroke="#0ea5e9" stroke-width="2" fill="none" class="vitals-wave"/>
                </svg>
              </div>
              <div class="flex space-x-2">
                <button class="flex-1 px-3 py-2 bg-primary-500 text-white text-sm rounded-lg hover:bg-primary-600 transition-colors">Record</button>
                <button class="px-3 py-2 bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-300 text-sm rounded-lg hover:bg-slate-300 dark:hover:bg-slate-500 transition-colors">Filter</button>
              </div>
            </div>

            <!-- Ventilator -->
            <div class="card p-4">
              <div class="flex items-center justify-between mb-3">
                <h4 class="text-sm font-semibold text-slate-900 dark:text-white">Ventilator</h4>
                <div class="w-2 h-2 bg-emerald-500 rounded-full pulse-dot"></div>
              </div>
              <div class="grid grid-cols-2 gap-3 text-sm">
                <div class="bg-slate-50 dark:bg-slate-700 p-2 rounded">
                  <div class="text-xs text-slate-500 dark:text-slate-400">Rate</div>
                  <div class="font-semibold text-slate-900 dark:text-white">16/min</div>
                </div>
                <div class="bg-slate-50 dark:bg-slate-700 p-2 rounded">
                  <div class="text-xs text-slate-500 dark:text-slate-400">Volume</div>
                  <div class="font-semibold text-slate-900 dark:text-white">450ml</div>
                </div>
                <div class="bg-slate-50 dark:bg-slate-700 p-2 rounded">
                  <div class="text-xs text-slate-500 dark:text-slate-400">Pressure</div>
                  <div class="font-semibold text-slate-900 dark:text-white">15 cmH2O</div>
                </div>
                <div class="bg-slate-50 dark:bg-slate-700 p-2 rounded">
                  <div class="text-xs text-slate-500 dark:text-slate-400">FiO2</div>
                  <div class="font-semibold text-slate-900 dark:text-white">40%</div>
                </div>
              </div>
            </div>

            <!-- Defibrillator -->
            <div class="card p-4">
              <div class="flex items-center justify-between mb-3">
                <h4 class="text-sm font-semibold text-slate-900 dark:text-white">Defibrillator</h4>
                <div class="w-2 h-2 bg-amber-500 rounded-full"></div>
              </div>
              <div class="text-sm text-slate-600 dark:text-slate-400 mb-3">Standby ‚Ä¢ Battery: 85%</div>
              <button class="w-full px-4 py-2 bg-red-500 text-white text-sm rounded-lg hover:bg-red-600 transition-colors">Charge Unit</button>
            </div>
          </div>
        </div>

        <!-- Timeline Tab Content -->
        <div id="timeline-tab" class="flex-1 p-4 overflow-y-auto hidden">
          <div class="space-y-4">
            <div class="flex items-start space-x-3">
              <div class="w-2 h-2 bg-emerald-500 rounded-full mt-2 pulse-dot"></div>
              <div class="flex-1">
                <div class="text-xs text-slate-500 dark:text-slate-400">14:45</div>
                <div class="text-sm font-medium text-slate-900 dark:text-white">Patient loaded</div>
                <div class="text-xs text-slate-600 dark:text-slate-400">Vitals stable, IV established</div>
              </div>
            </div>
            <div class="flex items-start space-x-3">
              <div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
              <div class="flex-1">
                <div class="text-xs text-slate-500 dark:text-slate-400">14:35</div>
                <div class="text-sm font-medium text-slate-900 dark:text-white">Morphine administered</div>
                <div class="text-xs text-slate-600 dark:text-slate-400">5mg IV - Pain reduced to 3/10</div>
              </div>
            </div>
            <div class="flex items-start space-x-3">
              <div class="w-2 h-2 bg-amber-500 rounded-full mt-2"></div>
              <div class="flex-1">
                <div class="text-xs text-slate-500 dark:text-slate-400">14:30</div>
                <div class="text-sm font-medium text-slate-900 dark:text-white">Initial assessment</div>
                <div class="text-xs text-slate-600 dark:text-slate-400">Vitals recorded, pain 8/10</div>
              </div>
            </div>
            <div class="flex items-start space-x-3">
              <div class="w-2 h-2 bg-red-500 rounded-full mt-2"></div>
              <div class="flex-1">
                <div class="text-xs text-slate-500 dark:text-slate-400">14:25</div>
                <div class="text-sm font-medium text-slate-900 dark:text-white">Emergency call</div>
                <div class="text-xs text-slate-600 dark:text-slate-400">Chest pain, male 45y</div>
              </div>
            </div>
            <div class="mt-6 pt-4 border-t border-slate-200 dark:border-slate-700">
              <button class="w-full px-4 py-2 bg-primary-500 text-white text-sm rounded-lg hover:bg-primary-600 transition-colors" onclick="showOffboardingModal()">
                Complete Case
              </button>
            </div>
          </div>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="flex-1 flex flex-col overflow-hidden">
        <!-- Main Content Tabs -->
        <div class="bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 px-6">
          <div class="flex space-x-8">
            <button class="px-1 py-4 text-sm font-medium border-b-2 border-primary-500 text-primary-600 dark:text-primary-400" onclick="switchMainTab('map', this)">Live Map</button>
            <button class="px-1 py-4 text-sm font-medium border-b-2 border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300" onclick="switchMainTab('cctv', this)">Live Vitals & CCTV</button>
            <button class="px-1 py-4 text-sm font-medium border-b-2 border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300" onclick="switchMainTab('communication', this)">Communication</button>
            <button class="px-1 py-4 text-sm font-medium border-b-2 border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300" onclick="switchMainTab('hospitals', this)">Hospital Network</button>
          </div>
        </div>

        <!-- Map Tab Content -->
        <div id="map-tab" class="flex-1 p-6">
          <div class="h-full card p-6 relative">
            <div class="status-badge">
              <span class="px-2 py-1 bg-emerald-500 text-white text-xs rounded-md">GPS Live</span>
            </div>

            <div class="flex items-center justify-between mb-4">
              <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Live Route Tracking</h3>
              <div class="flex items-center space-x-4">
                <div id="speedLabel" class="text-sm text-slate-600 dark:text-slate-400">Speed: 43 km/h</div>
                <div id="distanceLabel" class="text-sm text-slate-600 dark:text-slate-400">Distance: ‚Äî km</div>
                <div id="etaLabel" class="text-sm font-medium text-slate-900 dark:text-white">ETA: ‚Äî</div>
              </div>
            </div>

            <!-- Real Map replaces previous SVG -->
            <div class="h-full bg-slate-100 dark:bg-slate-700 rounded-lg relative overflow-hidden" style="min-height:480px">
              <div id="map" class="w-full h-full"></div>

              <!-- Map Controls -->
              <div class="absolute top-4 left-4 space-y-2 z-[500]">
                <button id="zoomInBtn" class="w-10 h-10 bg-white dark:bg-slate-800 rounded-lg shadow-lg flex items-center justify-center hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">
                  <svg class="w-5 h-5 text-slate-600 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                  </svg>
                </button>
                <button id="zoomOutBtn" class="w-10 h-10 bg-white dark:bg-slate-800 rounded-lg shadow-lg flex items-center justify-center hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">
                  <svg class="w-5 h-5 text-slate-600 dark:text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                  </svg>
                </button>
              </div>

              <!-- Route banner + speed control -->
              <div class="absolute top-4 right-4 z-[500] bg-white/90 dark:bg-slate-800/90 backdrop-blur rounded-lg shadow px-3 py-2 text-sm text-slate-700 dark:text-slate-200">
                <span class="font-semibold">From:</span> <span id="fromLabel">‚Äî</span>
                <span class="mx-2">‚Üí</span>
                <span class="font-semibold">To:</span> <span id="toLabel">‚Äî</span>
                <span class="ml-2 text-xs opacity-70" id="etaChip"></span>
              </div>

              <div class="absolute bottom-4 left-1/2 -translate-x-1/2 z-[500] bg-white dark:bg-slate-800 rounded-xl shadow px-4 py-3 flex gap-3 items-center">
                <button id="startBtn" class="px-3 py-2 rounded-lg bg-emerald-600 text-white text-sm hover:bg-emerald-500">Start Simulation</button>
                <label class="text-sm text-slate-700 dark:text-slate-200">Speed
                  <input id="speedRange" type="range" min="0.5" max="3" step="0.25" value="1" class="ml-2 align-middle">
                </label>
              </div>
            </div>
          </div>
        </div>

        <!-- CCTV Tab Content -->
        <div id="cctv-tab" class="flex-1 p-6 hidden">
          <div class="h-full">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-lg font-semibold text-slate-900 dark:text-white">CCTV Surveillance</h3>
              <div class="flex items-center space-x-3">
                <div class="status-badge">
                  <span class="px-2 py-1 bg-amber-500 text-white text-xs rounded-md">4G ‚Ä¢ 150ms</span>
                </div>
                <button class="px-3 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 text-sm rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors">Record All</button>
              </div>
            </div>

            <div class="grid grid-cols-2 gap-6 h-full">
              <div class="card p-4">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-sm font-semibold text-slate-900 dark:text-white">Cam-1</h4>
                  <div class="w-2 h-2 bg-red-500 rounded-full pulse-dot"></div>
                </div>
                <div class="bg-slate-900 rounded-lg h-48 relative overflow-hidden">
                  <div class="absolute inset-0 flex items-center justify-center text-white text-sm">üìπ Live Feed - Patient Bay</div>
                </div>
              </div>

              <div class="card p-4">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-sm font-semibold text-slate-900 dark:text-white">Cam-2</h4>
                  <div class="w-2 h-2 bg-red-500 rounded-full pulse-dot"></div>
                </div>
                <div class="bg-slate-900 rounded-lg h-48 relative overflow-hidden">
                  <div class="absolute inset-0 flex items-center justify-center text-white text-sm">üìπ Live Feed - Driver View</div>
                </div>
              </div>

              <div class="card p-4">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-sm font-semibold text-slate-900 dark:text-white">Multipara Monitor</h4>
                  <div class="w-2 h-2 bg-red-500 rounded-full pulse-dot"></div>
                </div>
                <div class="bg-slate-900 rounded-lg h-48 relative overflow-hidden">
                  <div class="absolute inset-0 flex items-center justify-center text-white text-sm">üìπ Live Feed - Equipment</div>
                </div>
              </div>

              <div class="card p-4">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-sm font-semibold text-slate-900 dark:text-white">Ventilator</h4>
                  <div class="w-2 h-2 bg-red-500 rounded-full pulse-dot"></div>
                </div>
                <div class="bg-slate-900 rounded-lg h-48 relative overflow-hidden">
                  <div class="absolute inset-0 flex items-center justify-center text-white text-sm">üìπ Live Feed - External</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Communication Tab Content -->
        <div id="communication-tab" class="flex-1 p-6 hidden">
          <div class="h-full grid grid-cols-2 gap-6">
            <!-- Chat as Prescription -->
            <div class="card p-6 flex flex-col">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Medical Orders</h3>
                <div class="status-badge">
                  <span class="px-2 py-1 bg-emerald-500 text-white text-xs rounded-md">WebRTC Live</span>
                </div>
              </div>

              <div class="flex-1 space-y-4 overflow-y-auto mb-4">
                <div class="bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg">
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-xs font-medium text-blue-600 dark:text-blue-400">Dr. Mehta</span>
                    <span class="text-xs text-slate-500">14:32</span>
                  </div>
                  <div class="text-sm text-slate-900 dark:text-white mb-3">"Administer 5mg morphine IV for pain management"</div>
                  <div class="p-3 bg-white dark:bg-slate-800 rounded-lg border-l-4 border-blue-500">
                    <div class="text-xs font-semibold text-slate-900 dark:text-white mb-1">Structured Order:</div>
                    <div class="text-xs text-slate-600 dark:text-slate-400">Drug: Morphine | Dose: 5mg | Route: IV | Indication: Pain</div>
                  </div>
                </div>

                <div class="bg-emerald-50 dark:bg-emerald-900/20 p-4 rounded-lg">
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-xs font-medium text-emerald-600 dark:text-emerald-400">Nurse Patel</span>
                    <span class="text-xs text-slate-500">14:35</span>
                  </div>
                  <div class="text-sm text-slate-900 dark:text-white">"Morphine administered. Patient reports pain reduced to 3/10"</div>
                </div>
              </div>

              <div class="flex space-x-2">
                <input type="text" placeholder="Type medical order..." class="flex-1 px-4 py-2 border border-slate-300 dark:border-slate-600 rounded-lg text-sm bg-white dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary-500 focus:border-transparent">
                <button class="px-4 py-2 bg-primary-500 text-white rounded-lg text-sm hover:bg-primary-600 transition-colors">Send</button>
                <button class="px-3 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg text-sm hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors">üé§</button>
                <button class="px-3 py-2 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded-lg text-sm hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors">üìπ</button>
              </div>
            </div>

            <!-- Video Conference -->
            <div class="card p-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Video Conference</h3>
                <div class="flex items-center space-x-2">
                  <div class="w-2 h-2 bg-emerald-500 rounded-full pulse-dot"></div>
                  <span class="text-xs text-slate-500">3 participants</span>
                </div>
              </div>

              <div class="grid grid-cols-2 gap-3 mb-4">
                <div class="bg-slate-900 rounded-lg h-32 relative overflow-hidden">
                  <div class="absolute inset-0 flex items-center justify-center text-white text-sm">üë®‚Äç‚öïÔ∏è Dr. Mehta</div>
                  <div class="absolute bottom-2 left-2 w-2 h-2 bg-emerald-500 rounded-full"></div>
                </div>
                <div class="bg-slate-900 rounded-lg h-32 relative overflow-hidden">
                  <div class="absolute inset-0 flex items-center justify-center text-white text-sm">üë©‚Äç‚öïÔ∏è Nurse Patel</div>
                  <div class="absolute bottom-2 left-2 w-2 h-2 bg-emerald-500 rounded-full"></div>
                </div>
                <div class="bg-slate-900 rounded-lg h-32 relative overflow-hidden col-span-2">
                  <div class="absolute inset-0 flex items-center justify-center text-white text-sm">üè• Control Center</div>
                  <div class="absolute bottom-2 left-2 w-2 h-2 bg-emerald-500 rounded-full"></div>
                </div>
              </div>

              <div class="flex justify-center space-x-3">
                <button class="px-4 py-2 bg-red-500 text-white rounded-lg text-sm hover:bg-red-600 transition-colors">üîá Mute</button>
                <button class="px-4 py-2 bg-slate-500 text-white rounded-lg text-sm hover:bg-slate-600 transition-colors">üìπ Video</button>
                <button class="px-4 py-2 bg-slate-500 text-white rounded-lg text-sm hover:bg-slate-600 transition-colors">üì± Share</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Hospital Network Tab Content -->
        <div id="hospitals-tab" class="flex-1 p-6 hidden">
          <div class="h-full">
            <div class="flex items-center justify-between mb-6">
              <h3 class="text-lg font-semibold text-slate-900 dark:text-white">Hospital Network</h3>
              <div class="flex items-center space-x-3">
                <div class="dropdown">
                  <button class="flex items-center space-x-2 px-3 py-2 bg-slate-100 dark:bg-slate-700 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors" onclick="toggleDropdown('hospitalFilters')">
                    <span class="text-sm text-slate-700 dark:text-slate-300">Filters</span>
                    <svg class="w-4 h-4 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                  </button>
                  <div class="dropdown-content" id="hospitalFilters">
                    <div class="p-3">
                      <div class="space-y-2">
                        <label class="flex items-center"><input type="checkbox" class="rounded mr-2" checked><span class="text-sm text-slate-700 dark:text-slate-300">Cardiology</span></label>
                        <label class="flex items-center"><input type="checkbox" class="rounded mr-2"><span class="text-sm text-slate-700 dark:text-slate-300">Emergency</span></label>
                        <label class="flex items-center"><input type="checkbox" class="rounded mr-2"><span class="text-sm text-slate-700 dark:text-slate-300">Trauma</span></label>
                        <hr class="my-2">
                        <label class="flex items-center"><input type="checkbox" class="rounded mr-2" checked><span class="text-sm text-slate-700 dark:text-slate-300">ICU Available</span></label>
                      </div>
                    </div>
                  </div>
                </div>
                <button class="flex items-center space-x-2 px-3 py-2 bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-300 rounded-lg hover:bg-primary-200 dark:hover:bg-primary-900/50 transition-colors" title="Ranking based on distance, specialty match, bed availability, and patient condition severity">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>
                  <span class="text-sm">Explain Ranking</span>
                </button>
              </div>
            </div>

            <div class="space-y-4">
              <div class="card p-6 border-l-4 border-emerald-500">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-lg font-semibold text-slate-900 dark:text-white">Apollo Hospital</h4>
                  <div class="flex items-center space-x-2">
                    <span class="px-2 py-1 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-300 text-xs font-medium rounded-md">95% Match</span>
                    <div class="w-2 h-2 bg-emerald-500 rounded-full pulse-dot"></div>
                  </div>
                </div>
                <div class="grid grid-cols-4 gap-4 mb-4">
                  <div class="text-center"><div class="text-2xl font-bold text-slate-900 dark:text-white">2.1</div><div class="text-xs text-slate-500">km</div></div>
                  <div class="text-center"><div class="text-2xl font-bold text-slate-900 dark:text-white">6</div><div class="text-xs text-slate-500">min ETA</div></div>
                  <div class="text-center"><div class="text-2xl font-bold text-emerald-600">3</div><div class="text-xs text-slate-500">ICU beds</div></div>
                  <div class="text-center"><div class="text-2xl font-bold text-blue-600">‚úì</div><div class="text-xs text-slate-500">Cardiology</div></div>
                </div>
                <div class="flex space-x-2">
                  <span class="px-2 py-1 bg-emerald-100 dark:bg-emerald-800 text-emerald-800 dark:text-emerald-200 text-xs rounded-md">ICU Ready</span>
                  <span class="px-2 py-1 bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 text-xs rounded-md">Cardiology</span>
                  <span class="px-2 py-1 bg-purple-100 dark:bg-purple-800 text-purple-800 dark:text-purple-200 text-xs rounded-md">Trauma Center</span>
                </div>
              </div>

              <div class="card p-6 border-l-4 border-amber-500">
                <div class="flex items-center justify-between mb-3">
                  <h4 class="text-lg font-semibold text-slate-900 dark:text-white">Max Hospital</h4>
                  <div class="flex items-center space-x-2">
                    <span class="px-2 py-1 bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-300 text-xs font-medium rounded-md">78% Match</span>
                    <div class="w-2 h-2 bg-amber-500 rounded-full"></div>
                  </div>
                </div>
                <div class="grid grid-cols-4 gap-4 mb-4">
                  <div class="text-center"><div class="text-2xl font-bold text-slate-900 dark:text-white">3.8</div><div class="text-xs text-slate-500">km</div></div>
                  <div class="text-center"><div class="text-2xl font-bold text-slate-900 dark:text-white">11</div><div class="text-xs text-slate-500">min ETA</div></div>
                  <div class="text-center"><div class="text-2xl font-bold text-amber-600">1</div><div class="text-xs text-slate-500">ICU beds</div></div>
                  <div class="text-center"><div class="text-2xl font-bold text-slate-400">‚Äî</div><div class="text-xs text-slate-500">General</div></div>
                </div>
                <div class="flex space-x-2">
                  <span class="px-2 py-1 bg-amber-100 dark:bg-amber-800 text-amber-800 dark:text-amber-200 text-xs rounded-md">Limited ICU</span>
                  <span class="px-2 py-1 bg-slate-100 dark:bg-slate-800 text-slate-800 dark:text-slate-200 text-xs rounded-md">General</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Offboarding Modal -->
  <div id="offboardingModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Complete Case Bundle</h3>
      <div class="space-y-4">
        <div class="flex items-center space-x-3"><input type="checkbox" id="pdfReport" checked class="rounded"><label for="pdfReport" class="text-sm text-gray-700 dark:text-gray-300">PDF Medical Report</label></div>
        <div class="flex items-center space-x-3"><input type="checkbox" id="fhirData" checked class="rounded"><label for="fhirData" class="text-sm text-gray-700 dark:text-gray-300">FHIR Data Bundle</label></div>
        <div class="flex items-center space-x-3"><input type="checkbox" id="vitalsData" checked class="rounded"><label for="vitalsData" class="text-sm text-gray-700 dark:text-gray-300">Vitals Timeline</label></div>
        <div class="flex items-center space-x-3"><input type="checkbox" id="cctvFootage" class="rounded"><label for="cctvFootage" class="text-sm text-gray-700 dark:text-gray-300">CCTV Footage (Optional)</label></div>
        <div class="flex items-center space-x-3"><input type="checkbox" id="audioRecords" class="rounded"><label for="audioRecords" class="text-sm text-gray-700 dark:text-gray-300">Audio Records (Optional)</label></div>
      </div>
      <div class="mt-6 flex space-x-3">
        <button onclick="generateBundle()" class="flex-1 px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">Generate Bundle</button>
        <button onclick="hideOffboardingModal()" class="px-4 py-2 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-400 dark:hover:bg-gray-500">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>

  <script>
    // Theme Toggle
    function toggleTheme() {
      const html = document.documentElement;
      html.classList.toggle('dark');
      localStorage.setItem('theme', html.classList.contains('dark') ? 'dark' : 'light');
    }
    if (localStorage.getItem('theme') === 'dark') document.documentElement.classList.add('dark');

    // Dropdown functionality
    function toggleDropdown(dropdownId) {
      document.querySelectorAll('.dropdown').forEach(dropdown => {
        if (dropdown.querySelector('#' + dropdownId) === null) dropdown.classList.remove('active');
      });
      const dropdown = document.querySelector('#' + dropdownId).closest('.dropdown');
      dropdown.classList.toggle('active');
    }
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.dropdown')) document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
    });

    // Sidebar Tab Switching
    function switchSidebarTab(tabName, button) {
      ['vitals', 'devices', 'timeline'].forEach(n => document.getElementById(n + '-tab').classList.add('hidden'));
      document.getElementById(tabName + '-tab').classList.remove('hidden');
      button.parentElement.querySelectorAll('button').forEach(btn => { btn.className = btn.className.replace('tab-active', 'tab-inactive'); });
      button.className = button.className.replace('tab-inactive', 'tab-active');
    }

    // Main Tab Switching
    function switchMainTab(tabName, button) {
      ['map','cctv','communication','hospitals'].forEach(n => document.getElementById(n + '-tab').classList.add('hidden'));
      document.getElementById(tabName + '-tab').classList.remove('hidden');
      button.parentElement.querySelectorAll('button').forEach(btn => {
        btn.className = 'px-1 py-4 text-sm font-medium border-b-2 border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300';
      });
      button.className = 'px-1 py-4 text-sm font-medium border-b-2 border-primary-500 text-primary-600 dark:text-primary-400';
    }

    // Offboarding Modal
    function showOffboardingModal() {
      const m = document.getElementById('offboardingModal');
      m.classList.remove('hidden'); m.classList.add('flex');
    }
    function hideOffboardingModal() {
      const m = document.getElementById('offboardingModal');
      m.classList.add('hidden'); m.classList.remove('flex');
    }
    function generateBundle() {
      const selected = [];
      if (document.getElementById('pdfReport').checked) selected.push('PDF Report');
      if (document.getElementById('fhirData').checked) selected.push('FHIR Bundle');
      if (document.getElementById('vitalsData').checked) selected.push('Vitals Data');
      if (document.getElementById('cctvFootage').checked) selected.push('CCTV Footage');
      if (document.getElementById('audioRecords').checked) selected.push('Audio Records');
      alert('Generating case bundle with: ' + selected.join(', '));
      hideOffboardingModal();
    }

    // Simulate small vitals changes
    setInterval(() => {
      const heartRateElements = document.querySelectorAll('.text-2xl.font-bold');
      heartRateElements.forEach(el => {
        if (!isNaN(parseInt(el.textContent))) {
          const v = parseInt(el.textContent);
          el.textContent = Math.max(65, Math.min(95, v + Math.floor(Math.random()*6)-3));
        }
      });
    }, 5000);

    // Initialize Map + Road-following simulation (Leaflet + OSRM)
    let map, polyline, routeLatLngs = [];
    let ambulanceMarker, originMarker, destMarker;
    let speedFactor = 1;
    const baseMetersPerSecond = 12; // ~43 km/h

    const origin = [28.6139, 77.2090];      // Example: Connaught Place, New Delhi
    const destination = [28.6300, 77.2500]; // Example: towards Laxmi Nagar

    function formatLatLng(latlng) { return latlng.map(n => n.toFixed(4)).join(', '); }

    function initMap() {
      map = L.map('map', { zoomControl: false, center: origin, zoom: 13 });
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

      const emojiIcon = (emoji, size=28) => L.divIcon({ html: '<div style=\"font-size:'+size+'px;\">'+emoji+'</div>', className: 'emoji-icon', iconSize: [size,size], iconAnchor: [size/2,size/2] });
      originMarker = L.marker(origin, { icon: emojiIcon('üìç', 22) }).addTo(map);
      destMarker   = L.marker(destination, { icon: emojiIcon('üè•', 26) }).addTo(map);
      ambulanceMarker = L.marker(origin, { icon: emojiIcon('üöë', 28) }).addTo(map);

      document.getElementById('fromLabel').textContent = formatLatLng(origin);
      document.getElementById('toLabel').textContent = formatLatLng(destination);
      document.getElementById('fromName').textContent = 'AIIMS Delhi';
      document.getElementById('toName').textContent = 'Apollo Hospital';

      document.getElementById('zoomInBtn').addEventListener('click', () => map.zoomIn());
      document.getElementById('zoomOutBtn').addEventListener('click', () => map.zoomOut());
      document.getElementById('speedRange').addEventListener('input', (e) => {
        speedFactor = parseFloat(e.target.value);
        const kmh = Math.round(baseMetersPerSecond * speedFactor * 3.6);
        document.getElementById('speedLabel').textContent = 'Speed: ' + kmh + ' km/h';
      });
      document.getElementById('startBtn').addEventListener('click', () => animateAlongRoute(routeLatLngs));
    }

    async function fetchRoute(start, end) {
      const url = 'https://router.project-osrm.org/route/v1/driving/'+start[1]+','+start[0]+';'+end[1]+','+end[0]+'?overview=full&geometries=geojson&annotations=distance,duration';
      const res = await fetch(url);
      if (!res.ok) throw new Error('OSRM route error');
      const data = await res.json();
      const r = data.routes[0];
      routeLatLngs = r.geometry.coordinates.map(([lng,lat]) => [lat,lng]);

      if (polyline) polyline.remove();
      polyline = L.polyline(routeLatLngs, { color: '#0ea5e9', weight: 5 }).addTo(map);
      map.fitBounds(polyline.getBounds(), { padding: [40,40] });

      const minutes = Math.round(r.duration / 60);
      document.getElementById('etaChip').textContent = '‚Ä¢ ETA ~ ' + minutes + ' min';
      document.getElementById('etaLabel').textContent = 'ETA: ' + minutes + ' min';
      document.getElementById('etaHeader').textContent = 'ETA: ' + minutes + ' min';

      const km = (r.distance/1000).toFixed(1);
      document.getElementById('distanceLabel').textContent = 'Distance: ' + km + ' km';
    }

    function fallbackRoute(start, end) {
      routeLatLngs = [start, end];
      if (polyline) polyline.remove();
      polyline = L.polyline(routeLatLngs, { color: '#0ea5e9', weight: 5, dashArray: '8 8' }).addTo(map);
      map.fitBounds(polyline.getBounds(), { padding: [40, 40] });
      document.getElementById('etaChip').textContent = '‚Ä¢ demo route';
    }

    function animateAlongRoute(points) {
      if (!points || points.length < 2) return;
      let t = 0;
      // Precompute segment distances and total length
      const distances = [];
      let total = 0;
      for (let i = 1; i < points.length; i++) {
        const d = map.distance(points[i-1], points[i]);
        distances.push(d); total += d;
      }
      function step() {
        const mps = baseMetersPerSecond * speedFactor;
        const advance = (mps / 60) / total; // frame step at ~60fps
        t += advance;
        if (t >= 1) { ambulanceMarker.setLatLng(points[points.length-1]); return; }
        // find segment
        let cum = 0;
        for (let i = 0; i < distances.length; i++) {
          const segFrac = distances[i] / total;
          if (t <= cum + segFrac) {
            const localT = (t - cum) / segFrac;
            const [lat1, lng1] = points[i];
            const [lat2, lng2] = points[i+1];
            ambulanceMarker.setLatLng([ lat1 + (lat2-lat1)*localT, lng1 + (lng2-lng1)*localT ]);
            break;
          }
          cum += segFrac;
        }
        requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    }

    document.addEventListener('DOMContentLoaded', async () => {
      // Default visible tabs
      document.getElementById('map-tab').classList.remove('hidden');
      document.getElementById('vitals-tab').classList.remove('hidden');

      initMap();
      try { await fetchRoute(origin, destination); } catch (e) { console.warn(e); fallbackRoute(origin, destination); }
    });
  </script>
</body>
</html>
